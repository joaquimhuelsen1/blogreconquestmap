{% extends "base.html" %}

{% block title %}Reconquest Test - Reconquest Blog{% endblock %}

{% block extra_css %}
<style>
    .quiz-container {
        max-width: 750px;
        margin: 0 auto;
        background-color: #fff;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .quiz-header {
        text-align: center;
        margin-bottom: 30px;
    }
    
    .quiz-header h1 {
        font-size: 2.2rem;
        color: #333;
        margin-bottom: 15px;
    }
    
    .quiz-header p {
        font-size: 1rem;
        color: #666;
    }
    
    .btn-quiz {
        background-color: #4a6fdc;
        border: none;
        padding: 10px 30px;
        font-weight: 600;
    }
    
    .btn-quiz:hover {
        background-color: #3a5fc9;
    }
</style>
{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="quiz-container">
        <div class="quiz-header">
            <h1>Reconquest Test</h1>
            <p>Answer the questions below honestly to get a personalized analysis of your situation.</p>
        </div>
        
        <form id="reconquistaForm">
            <div class="mb-4">
                <label for="nome" class="form-label">Full Name</label>
                <input type="text" class="form-control" id="nome" name="nome" required>
            </div>
            
            <div class="mb-4">
                <label for="idade" class="form-label">Your Age</label>
                <input type="number" class="form-control" id="idade" name="idade" min="18" required>
            </div>
            
            <div class="mb-4">
                <label for="nomeEx" class="form-label">Ex-partner's Name</label>
                <input type="text" class="form-control" id="nomeEx" name="nomeEx" required>
            </div>
            
            <div class="mb-4">
                <label for="idadeEx" class="form-label">Ex-partner's Age</label>
                <input type="number" class="form-control" id="idadeEx" name="idadeEx" min="18" required>
            </div>
            
            <div class="mb-4">
                <label for="tempoRelacionamento" class="form-label">How long did your relationship last? (years and months)</label>
                <input type="text" class="form-control" id="tempoRelacionamento" name="tempoRelacionamento" required>
            </div>
            
            <div class="mb-4">
                <label for="tempoTermino" class="form-label">How long since the breakup? (days, months or years)</label>
                <input type="text" class="form-control" id="tempoTermino" name="tempoTermino" required>
            </div>
            
            <div class="mb-4">
                <label for="motivoTermino" class="form-label">Main reason for the breakup</label>
                <textarea class="form-control" id="motivoTermino" name="motivoTermino" rows="3" required></textarea>
            </div>
            
            <div class="mb-4">
                <label for="email" class="form-label">Your Email</label>
                <input type="email" class="form-control" id="email" name="email" required>
            </div>
            
            <div class="mb-4">
                <label class="form-label">Are you a student of the Reconquest Map?</label>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="alunoMapa" id="alunoMapaSim" value="true">
                    <label class="form-check-label" for="alunoMapaSim">
                        Yes
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="alunoMapa" id="alunoMapaNao" value="false" checked>
                    <label class="form-check-label" for="alunoMapaNao">
                        No
                    </label>
                </div>
            </div>
            
            <div class="text-center mt-5">
                <button type="submit" class="btn btn-primary btn-lg btn-quiz" id="submitBtn">Submit Test</button>
                <div class="spinner-border text-primary mt-3 d-none" role="status" id="loadingSpinner">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </form>
        
        <div class="alert alert-success mt-4 d-none" id="successMessage">
            Test submitted successfully! We will analyze your answers and contact you by email.
        </div>
        
        <div class="alert alert-danger mt-4 d-none" id="errorMessage">
            There was an error submitting your test. Please try again later.
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('reconquistaForm');
        const submitBtn = document.getElementById('submitBtn');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const successMessage = document.getElementById('successMessage');
        const errorMessage = document.getElementById('errorMessage');
        
        // Form validation
        function validateForm() {
            let valid = true;
            const requiredFields = form.querySelectorAll('[required]');
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    valid = false;
                    field.classList.add('is-invalid');
                } else {
                    field.classList.remove('is-invalid');
                }
            });
            
            return valid;
        }
        
        // Form submission
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!validateForm()) {
                return;
            }
            
            // Show loading spinner
            submitBtn.disabled = true;
            loadingSpinner.classList.remove('d-none');
            successMessage.classList.add('d-none');
            errorMessage.classList.add('d-none');
            
            // Prepare form data
            const formData = {
                nome: document.getElementById('nome').value,
                idade: document.getElementById('idade').value,
                nomeEx: document.getElementById('nomeEx').value,
                idadeEx: document.getElementById('idadeEx').value,
                tempoRelacionamento: document.getElementById('tempoRelacionamento').value,
                tempoTermino: document.getElementById('tempoTermino').value,
                motivoTermino: document.getElementById('motivoTermino').value,
                email: document.getElementById('email').value,
                alunoMapa: document.querySelector('input[name="alunoMapa"]:checked').value,
                origem: 'teste_site'
            };
            
            // Send data to webhook
            fetch('https://hook.us1.make.com/dbe2w0qb61zn4zl0s5udfkhthckl6bq6', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                // Show success message
                successMessage.classList.remove('d-none');
                form.reset();
            })
            .catch(error => {
                // Show error message
                errorMessage.classList.remove('d-none');
                console.error('Error:', error);
            })
            .finally(() => {
                // Hide loading spinner
                submitBtn.disabled = false;
                loadingSpinner.classList.add('d-none');
            });
        });
    });
</script>
{% endblock %} 